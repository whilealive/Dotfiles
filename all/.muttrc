# ==================================================================
# FILE     .muttrc
# MACHINE  all
# INFO     for use with mbsync,
#          additional account files to be found in ~/.mutt/
#
# DATE     01.02.2014
# OWNER    Bischofberger
# ==================================================================


## ===================== global password management =====================
source "gpg2 -dq ~/.my-pwds.gpg |"


## ===================== ACCOUNTS =====================
# bruno.bischi@gmail.com
source "~/.mutt/gmail-bischi-account"
folder-hook gmail-bischi 'source ~/.mutt/gmail-bischi-account'

# pseudo-uzh account
source "~/.mutt/uzh-pseudo-account"
folder-hook uzh-pseudo 'source ~/.mutt/uzh-pseudo-account'

# pseudo-zhaw account
source "~/.mutt/zhaw-pseudo-account"
folder-hook zhaw-pseudo 'source ~/.mutt/zhaw-pseudo-account'

# mgmit.zhaw@gmail.com
#source "~/.mutt/gmail-mgmit-account"
#folder-hook gmail-mgmit 'source ~/.mutt/gmail-mgmit-account'

# bischofberger@fastmail.fm
source "~/.mutt/fastmail-account"
folder-hook fastmail 'source ~/.mutt/fastmail-account'


## ===================== mutt behavior =====================
source "~/.mutt/colors"              # colors
set pager_index_lines = "15"         # split screen to watch index and pager simultaneously
set mail_check = 60                  # How often to check for new mail (time in seconds).
set pager_stop                       # Don't go to next message when at the end of message
set mark_old = no                    # Don't mark messages as old

# convert time to local timezone and print in pager
set pager_format  = "%4C %Z %[!%e. %B %Y - %H:%M]  %.20n  %s%* -- (%P)"
ignore *
unignore From:
unignore To:
unignore Subject:
unignore Reply-To:

# sort threads from newest to oldest (top to bottom)
set sort         = threads
set sort_browser = reverse-date
set sort_aux     = reverse-last-date-received
set uncollapse_jump

# include attachments in forwarded messages
set mime_forward = yes
set mime_forward_rest = yes

# skip prompts
set fast_reply    = yes
set include       = yes
set forward_quote = yes
set copy          = yes
set delete        = yes
set confirmappend = no
set abort_nosubject = no

# Mailing lists
lists dev@suckless.org
subscribe dev@suckless.org

# bindings
bind pager q            exit
bind pager /            search
bind pager <up>         previous-line
bind pager <down>       next-line
bind pager k            previous-line
bind pager j            next-line
bind pager gg           top
bind pager G            bottom
bind index gg           first-entry
bind index G            last-entry
bind pager K            previous-undeleted
bind pager J            next-undeleted
bind index K            previous-unread
bind index J            next-unread
bind index W            clear-flag
bind index w            set-flag
bind index,pager R      group-reply
bind compose p          pgp-menu
bind attach <return>    view-mailcap

# folder changes
macro index,pager gf "<change-folder> ~/Maildir/fastmail/INBOX<enter>" "go to fastmail INBOX"
macro index,pager gb "<change-folder> ~/Maildir/gmail-bischi/INBOX<enter>" "go to gmail-bischi INBOX"
macro index,pager gu "<change-folder> ~/Maildir/uzh-pseudo/INBOX_uzh<enter>" "go to pseudo-uzh INBOX"
macro index,pager gz "<change-folder> ~/Maildir/zhaw-pseudo/INBOX_zhaw<enter>" "go to pseudo-zhaw INBOX"
macro index,pager gs "<change-folder> ~/Maildir/fastmail/INBOX_suckless-dev<enter>" "go to suckless-dev INBOX"
macro index,pager gm "<change-folder> ~/Maildir/gmail-mgmit/INBOX<enter>" "go to mgmit INBOX"

# change folders quickly
set sleep_time = 0

# mark all new messages as read (for trash folder)
macro index .n "<tag-pattern>~N<enter><tag-prefix><clear-flag>N<clear-flag>*" "mark all new messages as read"

## ===================== mutt-sidebar stuff =====================
set sidebar_visible      = yes
set sidebar_width        = 30
set sidebar_sort         = yes
set sidebar_shortpath    = no
color sidebar_new brightcyan default
macro index b '<enter-command>toggle sidebar_visible<enter><refresh>'
macro pager b '<enter-command>toggle sidebar_visible<enter><redraw-screen>'
bind index,pager \Cx sidebar-prev
bind index,pager \Cy sidebar-next
bind index,pager \Co sidebar-open


## ===================== other extensions =====================
set alias_file=~/.mutt/mutt-alias
source ~/.mutt/mutt-alias
set query_command= "abook --mutt-query '%s'" 
macro index,pager A "<pipe-message>abook --add-email-quiet<return>" "add the sender address to abook"

# html view in w3m
set mailcap_path = "~/.mutt/mailcap"
auto_view text/html

# urlview stuff
macro index,pager \cb <pipe-entry>'urlview'<enter> 'Follow links with urlview'

# pymuttprint
set print_command="~/Build/$(hostname)/pymuttprint/pymuttprint.py && zathura /tmp/texput.pdf"
set print_decode="yes"
set print_split="no"
