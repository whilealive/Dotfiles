# ==================================================================
# FILE     .muttrc
# MACHINE  all
# INFO     for use with mbsync,
#          additional account files to be found in ~/.mutt/
#
# DATE     25.02.2017
# OWNER    Bischofberger
# ==================================================================


## ===================== global password management =====================
source "gpg2 -dq ~/.my-pwds.gpg |"


## ===================== ACCOUNTS =====================
# bruno.bischofberger@bms-zuerich.ch
source "~/.mutt/bmz-account"
folder-hook bmz 'source ~/.mutt/bmz-account'

# pseudo-uzh account
source "~/.mutt/uzh-pseudo-account"
folder-hook uzh-pseudo 'source ~/.mutt/uzh-pseudo-account'

# bischofberger@fastmail.fm
source "~/.mutt/fastmail-account"
folder-hook fastmail 'source ~/.mutt/fastmail-account'

## ===================== mutt behavior =====================
source "~/.mutt/colors"              # colors
set pager_index_lines = "15"         # split screen to watch index and pager simultaneously
set mail_check = 60                  # How often to check for new mail (time in seconds).
set pager_stop                       # Don't go to next message when at the end of message
set mark_old = no                    # Don't mark messages as old
set menu_scroll                      # scroll line-by-line (not page-by-page)

# convert time to local timezone and print in pager
set pager_format  = "%4C %Z %[!%e. %B %Y - %H:%M]  %.20n  %s%* -- (%P)"
ignore *
unignore From: To: Subject: CC: Reply-To: 
unignore User-Agent:

# order of prefered mime types
alternative_order text/html text/enriched text/plain

# sort threads from newest to oldest (top to bottom)
set sort         = threads
set sort_browser = reverse-date
set sort_aux     = reverse-last-date-received
set uncollapse_jump

# sidebar
# Ctrl-n, Ctrl-p to select next, previous folder.
# Ctrl-o to open selected folder.
set sidebar_visible = no
bind index,pager B sidebar-toggle-visible
bind index,pager \CP sidebar-prev
bind index,pager \CN sidebar-next
bind index,pager \CO sidebar-open

# include attachments in forwarded messages
set mime_forward = ask-yes
set mime_forward_rest = yes
# Note: for forwarding a html message included below current message, use v to see
# the attachements and tag ("t") "text/html". Then press ;f.
# For forwarding any attachments use the same procedure.

# skip prompts
set fast_reply    = yes
set include       = yes
set forward_quote = yes
set copy          = yes
set delete        = yes
set confirmappend = no
set abort_nosubject = no

# Mailing lists
subscribe dev@suckless.org texhax@tug.org lucida@tug.org ntg-context@ntg.nl vim@vim.org vim_dev@vim.org

# bindings
bind pager q            exit
bind pager /            search
bind pager <up>         previous-line
bind pager <down>       next-line
bind pager k            previous-line
bind pager j            next-line
bind pager gg           top
bind pager G            bottom
bind index gg           first-entry
bind index G            last-entry
bind pager K            previous-undeleted
bind pager J            next-undeleted
bind index K            previous-unread
bind index J            next-unread
bind index W            clear-flag
bind index w            set-flag
bind index,pager R      group-reply
bind compose p          pgp-menu
bind attach <return>    view-mailcap

# folder changes
macro index,pager gf "<sync-mailbox><change-folder> ~/Maildir/fastmail/INBOX<enter>" "go to fastmail INBOX"
macro index,pager gb "<sync-mailbox><change-folder> ~/Maildir/bmz/INBOX<enter>" "go to bmz INBOX"
macro index,pager gu "<sync-mailbox><change-folder> ~/Maildir/uzh-pseudo/uzh<enter>" "go to pseudo-uzh INBOX"
macro index,pager gs "<sync-mailbox><change-folder> ~/Maildir/fastmail/suckless-dev<enter>" "go to suckless-dev INBOX"
macro index,pager gt "<sync-mailbox><change-folder> ~/Maildir/fastmail/tug<enter>" "go to tug INBOX"
macro index,pager gc "<sync-mailbox><change-folder> ~/Maildir/fastmail/ConTeXt<enter>" "go to ConTeXt INBOX"
macro index,pager gv "<sync-mailbox><change-folder> ~/Maildir/fastmail/vim<enter>" "go to vim INBOX"

# change folders quickly
set sleep_time = 0

# mark all new messages as read (for trash folder)
macro index .n "<tag-pattern>~N<enter><tag-prefix><clear-flag>N<clear-flag>*" "mark all new messages as read"

# empty trashes in local maildir
macro index .t "<change-folder> ~/Maildir/fastmail/Trash<enter><sync-mailbox> \
                <change-folder> ~/Maildir/bmz/Trash<enter><sync-mailbox> \
                <change-folder> ~/Maildir/fastmail/INBOX<enter><sync-mailbox>" "empty trashes in local maildir"


## ===================== extensions =====================
set query_command= "abook --mutt-query '%s'" 
macro index,pager A "<pipe-message>abook --add-email-quiet<return>" "add the sender address to abook"
bind editor <Tab> complete-query

# html view in w3m
set mailcap_path = "~/.mutt/mailcap"
auto_view text/html

# pymuttprint
set print_command="~/Build/$(hostname)/pymuttprint/pymuttprint.py && zathuratab /tmp/texput.pdf"
set print_decode="yes"
set print_split="no"
